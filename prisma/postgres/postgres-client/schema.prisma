generator client {
  provider = "prisma-client-js"
  output   = "./postgres-client"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL_POSTGRES")
  directUrl = env("DIRECT_URL_POSTGRES")
}

enum Permission {
  DEFAULT
  READONLY
  SUSPENDED
}

model profiles {
  id                  String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  blocked_users       String[]   @default([]) @db.Uuid
  blocked_communities String[]   @default([]) @db.Uuid
  avatar              String?
  bio                 String?
  display_name        String?
  gender              String?
  location            String?
  permission          Permission @default(DEFAULT)
  saved_posts         String[]   @default([]) @db.Uuid
  upvoted_posts       String[]   @default([]) @db.Uuid
  downvoted_posts     String[]   @default([]) @db.Uuid
}

enum MediaType {
  IMAGE
  VIDEO
  EXTERNAL_LINK
}

model posts {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id     String    @db.Uuid
  hashtags    String[]
  content     String
  mediaType   MediaType
  mediaUrls   String[]
  upvotes     Int
  downvotes   Int
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  comments_id String[]  @db.Uuid
}

enum Visibility {
  PUBLIC
  RESTRICTED
  PRIVATE
  CACHED
}

model communities {
  id           String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name         String
  description  String
  icon         String?
  banner       String?
  visibility   Visibility @default(PUBLIC)
  rules        Json       @default("{}")
  pinned_posts String[]   @db.Uuid
  topics       String[]   @default([])
}

model comments {
  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  user_id     String   @db.Uuid
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  upvotes     Int
  downvotes   Int
  content     String
  parent_id   String?
  comments_id String[] @db.Uuid
}

enum Role {
  OWNER
  MODERATOR
  MEMBER
}

enum NotificationPreference {
  OFF
  LOW
  FREQUENT
}

model community_user {
  community_id String @db.Uuid
  user_id      String @db.Uuid

  role Role @default(MEMBER)

  favorite Boolean @default(false)

  notificationPreference NotificationPreference @default(OFF)

  creadit Int @default(0)

  @@id([community_id, user_id])
}
